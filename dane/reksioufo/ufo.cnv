OBJECT=MOUSE
MOUSE:TYPE=MOUSE
MOUSE:ONCLICK={ /
    @IF("WAVSOUND^ISPLAYING()","_","TRUE","{WAVSOUND^STOP(TRUE);}",""); /
}

OBJECT=KEYBOARD
KEYBOARD:TYPE=KEYBOARD

OBJECT=CNVLOADER
CNVLOADER:TYPE=CNVLOADER

OBJECT=CANAS_OBSERVER
CANAS_OBSERVER:TYPE=CANVAS_OBSERVER

OBJECT=TEXTBOX_BKG
TEXTBOX_BKG:TYPE=IMAGE
TEXTBOX_BKG:FILENAME=TEXTBOX.IMG
TEXTBOX_BKG:VISIBLE=FALSE
TEXTBOX_BKG:TOCANVAS=TRUE
TEXTBOX_BKG:PRIORITY=900
TEXTBOX_BKG:PRELOAD=TRUE
TEXTBOX_BKG:RELEASE=TRUE
TEXTBOX_BKG:MONITORCOLLISION=FALSE
TEXTBOX_BKG:MONITORCOLLISIONALPHA=FALSE

OBJECT=TEXTBOX_AVATAR
TEXTBOX_AVATAR:TYPE=IMAGE
TEXTBOX_AVATAR:FILENAME=AVATAR1.IMG
TEXTBOX_AVATAR:VISIBLE=FALSE
TEXTBOX_AVATAR:TOCANVAS=TRUE
TEXTBOX_AVATAR:PRIORITY=902
TEXTBOX_AVATAR:PRELOAD=TRUE
TEXTBOX_AVATAR:RELEASE=TRUE
TEXTBOX_AVATAR:MONITORCOLLISION=FALSE
TEXTBOX_AVATAR:MONITORCOLLISIONALPHA=FALSE

OBJECT=FNTARIAL
FNTARIAL:TYPE=FONT
FNTARIAL:DEF_ARIAL_STANDARD_14=ARIAL14.FNT

OBJECT=TEXTBOX
TEXTBOX:TYPE=TEXT
TEXTBOX:VISIBLE=FALSE
TEXTBOX:FONT=FNTARIAL
TEXTBOX:TOCANVAS=TRUE
TEXTBOX:RECT=140,450,480,575
TEXTBOX:PRIORITY=901
TEXTBOX:HJUSTIFY=FALSE
TEXTBOX:VJUSTIFY=FALSE
TEXTBOX:MONITORCOLLISION=FALSE
TEXTBOX:MONITORCOLLISIONALPHA=FALSE

OBJECT=SLINE
SLINE:TYPE=STRUCT
SLINE:FIELDS=TEXT<STRING>

OBJECT=WAVTEXT
WAVTEXT:TYPE=DATABASE
WAVTEXT:MODEL=SLINE

OBJECT=LINE_TO_SAY
LINE_TO_SAY:TYPE=STRING

OBJECT=WAVSOUND
WAVSOUND:TYPE=SOUND
WAVSOUND:FILENAME=NARR21_0_2.WAV
WAVSOUND:PRELOAD=FALSE
WAVSOUND:FLUSHAFTERPLAYED=FALSE
WAVSOUND:ONSTARTED={ /
    @IF("LINE_TO_SAY","!_","NULL","{SHOW_TEXT^RUN(LINE_TO_SAY);}",""); /
}
WAVSOUND:ONFINISHED=HIDE_TEXT

OBJECT=SHOW_TEXT
SHOW_TEXT:TYPE=BEHAVIOUR
SHOW_TEXT:CODE={ /
    TEXTBOX^SETTEXT($1); /
    TEXTBOX_BKG^SHOW(); /
    TEXTBOX_AVATAR^SHOW(); /
    TEXTBOX^SHOW(); /
}

OBJECT=HIDE_TEXT
HIDE_TEXT:TYPE=BEHAVIOUR
HIDE_TEXT:CODE={ /
    TEXTBOX^HIDE(); /
    TEXTBOX_AVATAR^HIDE(); /
    TEXTBOX_BKG^HIDE(); /
    TEXTBOX^SETTEXT(""); /
}

OBJECT=WAVPATH
WAVPATH:TYPE=STRING

OBJECT=TXTPATH
TXTPATH:TYPE=STRING

OBJECT=SAY
SAY:TYPE=BEHAVIOUR
SAY:CODE={ /
    WAVPATH^SET(["$WAVS\"+$1+".WAV"]); /
    TXTPATH^SET(["$WAVS\"+$1+".TXT"]); /
    WAVSOUND^LOAD(WAVPATH); /
    LOAD_LINE_TO_SAY^RUN(); /
    WAVSOUND^PLAY(); /
}

OBJECT=LOAD_LINE_TO_SAY
LOAD_LINE_TO_SAY:TYPE=BEHAVIOUR
LOAD_LINE_TO_SAY:CODE={ /
    WAVTEXT^REMOVEALL(); /
    WAVTEXT^LOAD(TXTPATH); /
    @IF("WAVTEXT^GETROWSNO()", ">", "0", "SET_LINE_TO_SAY", "CLEAR_LINE_TO_SAY"); /
}

OBJECT=SET_LINE_TO_SAY
SET_LINE_TO_SAY:TYPE=BEHAVIOUR
SET_LINE_TO_SAY:CODE={ /
    WAVTEXT^SELECT(0); /
    SLINE^SET("WAVTEXT_CURSOR"); /
    LINE_TO_SAY^SET(SLINE|TEXT); /
}

OBJECT=CLEAR_LINE_TO_SAY
CLEAR_LINE_TO_SAY:TYPE=BEHAVIOUR
CLEAR_LINE_TO_SAY:CODE={ /
    LINE_TO_SAY^SET(NULL); /
}
