OBJECT=CALLBACK_TIMER_ROUTINE
CALLBACK_TIMER_ROUTINE:TYPE=STRING

OBJECT=CALLBACK_TIMER
CALLBACK_TIMER:TYPE=TIMER
CALLBACK_TIMER:ENABLED=TRUE
CALLBACK_TIMER:ELAPSE=100
CALLBACK_TIMER:TICKS=1
CALLBACK_TIMER:ONTICK^1={ /
    CALLBACK_TIMER^RESET(); /
    CALLBACK_TIMER^ENABLE(); /
    @IF(ROUTINE_TO_CALL, "!_", NULL, "{CALLBACK_TIMER_ROUTINE^SET(ROUTINE_TO_CALL); ROUTINE_TO_CALL^SET(NULL); *CALLBACK_TIMER_ROUTINE^RUN();}", ""); /
}

OBJECT=KEYBOARD
KEYBOARD:TYPE=KEYBOARD
KEYBOARD:ONKEYDOWN={ /
    @IF(KEYBOARD^GETLATESTKEY(), "_", "ESC", "{EPISODE^GOTO("MENU"); TEXTBOX_BREAK^RUN(); }", ""); /
}

OBJECT=MAX1
MAX1:TYPE=INTEGER
MAX1:VALUE=12

OBJECT=MAX2
MAX2:TYPE=INTEGER
MAX2:VALUE=8

OBJECT=MAX3
MAX3:TYPE=INTEGER
MAX3:VALUE=5

OBJECT=EXPECTED1
EXPECTED1:TYPE=INTEGER
EXPECTED1:VALUE=6

OBJECT=EXPECTED2
EXPECTED2:TYPE=INTEGER
EXPECTED2:VALUE=6

OBJECT=CURRENT1
CURRENT1:TYPE=INTEGER
CURRENT1:VALUE=0
CURRENT1:ONCHANGED=UPDATE_DIGITS1

OBJECT=CURRENT2
CURRENT2:TYPE=INTEGER
CURRENT2:VALUE=0
CURRENT2:ONCHANGED=UPDATE_DIGITS2

OBJECT=CURRENT3
CURRENT3:TYPE=INTEGER
CURRENT3:VALUE=0
CURRENT3:ONCHANGED=UPDATE_DIGITS3

OBJECT=BKG_BECZKA
BKG_BECZKA:TYPE=IMAGE
BKG_BECZKA:VISIBLE=FALSE
BKG_BECZKA:FILENAME=BKG_BECZKA.IMG
BKG_BECZKA:TOCANVAS=TRUE
BKG_BECZKA:PRIORITY=0

OBJECT=BKG_PIECYK
BKG_PIECYK:TYPE=IMAGE
BKG_PIECYK:VISIBLE=FALSE
BKG_PIECYK:FILENAME=BKG_PIECYK.IMG
BKG_PIECYK:TOCANVAS=TRUE
BKG_PIECYK:PRIORITY=0

OBJECT=RADIATOR
RADIATOR:TYPE=IMAGE
RADIATOR:VISIBLE=TRUE
RADIATOR:FILENAME=RADIATOR.IMG
RADIATOR:TOCANVAS=TRUE
RADIATOR:PRIORITY=10

OBJECT=LED1
LED1:TYPE=IMAGE
LED1:VISIBLE=FALSE
LED1:FILENAME=OK1.IMG
LED1:TOCANVAS=TRUE
LED1:PRIORITY=20

OBJECT=LED2
LED2:TYPE=IMAGE
LED2:VISIBLE=FALSE
LED2:FILENAME=OK2.IMG
LED2:TOCANVAS=TRUE
LED2:PRIORITY=20

OBJECT=BUTTON_1DO2
BUTTON_1DO2:TYPE=ANIMO
BUTTON_1DO2:VISIBLE=TRUE
BUTTON_1DO2:FILENAME=1DO2.ANN
BUTTON_1DO2:TOCANVAS=TRUE
BUTTON_1DO2:PRIORITY=20
BUTTON_1DO2:ONINIT={THIS^SETASBUTTON(TRUE, TRUE);}
BUTTON_1DO2:ONFOCUSON={;}
BUTTON_1DO2:ONCLICK={MOVE_FLUID^RUN(1, 2);}

OBJECT=BUTTON_1DO3
BUTTON_1DO3:TYPE=ANIMO
BUTTON_1DO3:VISIBLE=TRUE
BUTTON_1DO3:FILENAME=1DO3.ANN
BUTTON_1DO3:TOCANVAS=TRUE
BUTTON_1DO3:PRIORITY=20
BUTTON_1DO3:ONINIT={THIS^SETASBUTTON(TRUE, TRUE);}
BUTTON_1DO3:ONFOCUSON={;}
BUTTON_1DO3:ONCLICK={MOVE_FLUID^RUN(1, 3);}

OBJECT=BUTTON_2DO1
BUTTON_2DO1:TYPE=ANIMO
BUTTON_2DO1:VISIBLE=TRUE
BUTTON_2DO1:FILENAME=2DO1.ANN
BUTTON_2DO1:TOCANVAS=TRUE
BUTTON_2DO1:PRIORITY=20
BUTTON_2DO1:ONINIT={THIS^SETASBUTTON(TRUE, TRUE);}
BUTTON_2DO1:ONFOCUSON={;}
BUTTON_2DO1:ONCLICK={MOVE_FLUID^RUN(2, 1);}

OBJECT=BUTTON_2DO3
BUTTON_2DO3:TYPE=ANIMO
BUTTON_2DO3:VISIBLE=TRUE
BUTTON_2DO3:FILENAME=2DO3.ANN
BUTTON_2DO3:TOCANVAS=TRUE
BUTTON_2DO3:PRIORITY=20
BUTTON_2DO3:ONINIT={THIS^SETASBUTTON(TRUE, TRUE);}
BUTTON_2DO3:ONFOCUSON={;}
BUTTON_2DO3:ONCLICK={MOVE_FLUID^RUN(2, 3);}

OBJECT=BUTTON_3DO1
BUTTON_3DO1:TYPE=ANIMO
BUTTON_3DO1:VISIBLE=TRUE
BUTTON_3DO1:FILENAME=3DO1.ANN
BUTTON_3DO1:TOCANVAS=TRUE
BUTTON_3DO1:PRIORITY=20
BUTTON_3DO1:ONINIT={THIS^SETASBUTTON(TRUE, TRUE);}
BUTTON_3DO1:ONFOCUSON={;}
BUTTON_3DO1:ONCLICK={MOVE_FLUID^RUN(3, 1);}

OBJECT=BUTTON_3DO2
BUTTON_3DO2:TYPE=ANIMO
BUTTON_3DO2:VISIBLE=TRUE
BUTTON_3DO2:FILENAME=3DO2.ANN
BUTTON_3DO2:TOCANVAS=TRUE
BUTTON_3DO2:PRIORITY=20
BUTTON_3DO2:ONINIT={THIS^SETASBUTTON(TRUE, TRUE);}
BUTTON_3DO2:ONFOCUSON={;}
BUTTON_3DO2:ONCLICK={MOVE_FLUID^RUN(3, 2);}

OBJECT=BUTELKA_STAN1
BUTELKA_STAN1:TYPE=ANIMO
BUTELKA_STAN1:VISIBLE=TRUE
BUTELKA_STAN1:FILENAME=BUT1.ANN
BUTELKA_STAN1:TOCANVAS=TRUE
BUTELKA_STAN1:PRIORITY=20

OBJECT=BUTELKA_STAN2
BUTELKA_STAN2:TYPE=ANIMO
BUTELKA_STAN2:VISIBLE=TRUE
BUTELKA_STAN2:FILENAME=BUT2.ANN
BUTELKA_STAN2:TOCANVAS=TRUE
BUTELKA_STAN2:PRIORITY=20

OBJECT=BUTELKA_STAN3
BUTELKA_STAN3:TYPE=ANIMO
BUTELKA_STAN3:VISIBLE=TRUE
BUTELKA_STAN3:FILENAME=BUT3.ANN
BUTELKA_STAN3:TOCANVAS=TRUE
BUTELKA_STAN3:PRIORITY=20

OBJECT=DIGIT1_THOUSANDS
DIGIT1_THOUSANDS:TYPE=ANIMO
DIGIT1_THOUSANDS:VISIBLE=TRUE
DIGIT1_THOUSANDS:FILENAME=CYFRY1_3.ANN
DIGIT1_THOUSANDS:TOCANVAS=TRUE
DIGIT1_THOUSANDS:PRIORITY=20
DIGIT1_THOUSANDS:ONINIT={THIS^SETPOSITION(192, 442); THIS^PLAY("0");}

OBJECT=DIGIT1_HUNDREDS
DIGIT1_HUNDREDS:TYPE=ANIMO
DIGIT1_HUNDREDS:VISIBLE=TRUE
DIGIT1_HUNDREDS:FILENAME=CYFRY1_2.ANN
DIGIT1_HUNDREDS:TOCANVAS=TRUE
DIGIT1_HUNDREDS:PRIORITY=20
DIGIT1_HUNDREDS:ONINIT={THIS^SETPOSITION(211, 442); THIS^PLAY("0");}

OBJECT=DIGIT2_HUNDREDS
DIGIT2_HUNDREDS:TYPE=ANIMO
DIGIT2_HUNDREDS:VISIBLE=TRUE
DIGIT2_HUNDREDS:FILENAME=CYFRY2_2.ANN
DIGIT2_HUNDREDS:TOCANVAS=TRUE
DIGIT2_HUNDREDS:PRIORITY=20
DIGIT2_HUNDREDS:ONINIT={THIS^SETPOSITION(270, 442); THIS^PLAY("0");}

OBJECT=DIGIT3_HUNDREDS
DIGIT3_HUNDREDS:TYPE=ANIMO
DIGIT3_HUNDREDS:VISIBLE=TRUE
DIGIT3_HUNDREDS:FILENAME=CYFRY3_2.ANN
DIGIT3_HUNDREDS:TOCANVAS=TRUE
DIGIT3_HUNDREDS:PRIORITY=20
DIGIT3_HUNDREDS:ONINIT={THIS^SETPOSITION(329, 442); THIS^PLAY("0");}

OBJECT=__INIT__
__INIT__:TYPE=BEHAVIOUR
__INIT__:CODE={ /
    ARRAYPRZEDMIOTY^REMOVEALL(); /
    BEHINITSCENE^RUN("SIGMALIS"); /
    BEHHIDEMENUALL^RUN(); /
    ENTERED_NON_CUTSCENE^SET(TRUE); /
    @IF(ZBUDOWANE^CONTAINS("BECZKA"), "_", TRUE, "{BKG_BECZKA^SHOW();}", "{BKG_PIECYK^SHOW();}"); /
    CURRENT1^SET(12); /
    SHOW_BOTTLE_FLUID_LEVEL^RUNLOOPED(1, 3); /
    SAY^RUN("SIGMALIS"); /
}

OBJECT=UPDATE_DIGITS1
UPDATE_DIGITS1:TYPE=BEHAVIOUR
UPDATE_DIGITS1:CODE={ /
    DIGIT1_THOUSANDS^PLAY([CURRENT1^GET() @ 10]); /
    DIGIT1_HUNDREDS^PLAY([CURRENT1^GET() % 10]); /
    @IF(CURRENT1^GET(), "_", EXPECTED1^GET(), "{LED1^SHOW();}", "{LED1^HIDE();}"); /
}

OBJECT=UPDATE_DIGITS2
UPDATE_DIGITS2:TYPE=BEHAVIOUR
UPDATE_DIGITS2:CODE={ /
    DIGIT2_HUNDREDS^PLAY([CURRENT2^GET() % 10]); /
    @IF(CURRENT2^GET(), "_", EXPECTED2^GET(), "{LED2^SHOW();}", "{LED2^HIDE();}"); /
}

OBJECT=UPDATE_DIGITS3
UPDATE_DIGITS3:TYPE=BEHAVIOUR
UPDATE_DIGITS3:CODE={ /
    DIGIT3_HUNDREDS^PLAY([CURRENT3^GET() % 10]); /
}

OBJECT=MOVE_FLUID_SOURCE
MOVE_FLUID_SOURCE:TYPE=STRING

OBJECT=MOVE_FLUID_DRAIN
MOVE_FLUID_DRAIN:TYPE=STRING

OBJECT=MOVE_FLUID_DRAIN_MAX
MOVE_FLUID_DRAIN_MAX:TYPE=STRING

OBJECT=MOVE_FLUID_VALUE
MOVE_FLUID_VALUE:TYPE=INTEGER

OBJECT=MOVE_FLUID_SPACE_AVAILABLE
MOVE_FLUID_SPACE_AVAILABLE:TYPE=INTEGER

OBJECT=MOVE_FLUID
MOVE_FLUID:TYPE=BEHAVIOUR
MOVE_FLUID:CODE={ /
    MOVE_FLUID_SOURCE^SET(["CURRENT" + $1]); /
    MOVE_FLUID_DRAIN^SET(["CURRENT" + $2]); /
    MOVE_FLUID_DRAIN_MAX^SET(["MAX" + $2]); /
    MOVE_FLUID_VALUE^SET(*MOVE_FLUID_SOURCE^GET()); /
    MOVE_FLUID_SPACE_AVAILABLE^SET(*MOVE_FLUID_DRAIN_MAX^GET()); /
    MOVE_FLUID_SPACE_AVAILABLE^SUB(*MOVE_FLUID_DRAIN^GET()); /
    @IF(MOVE_FLUID_VALUE, ">", MOVE_FLUID_SPACE_AVAILABLE, "{MOVE_FLUID_VALUE^SET(MOVE_FLUID_SPACE_AVAILABLE^GET());}"); /
    *MOVE_FLUID_DRAIN^ADD(MOVE_FLUID_VALUE); /
    *MOVE_FLUID_SOURCE^SUB(MOVE_FLUID_VALUE); /
    SHOW_BOTTLE_FLUID_LEVEL^RUNLOOPED(1, 3); /
    @IF("CURRENT1^GET()'EXPECTED1^GET()&&CURRENT2^GET()'EXPECTED2^GET()", "RADIATOR_ON_WIN", ""); /
}

OBJECT=RADIATOR_ON_WIN
RADIATOR_ON_WIN:TYPE=BEHAVIOUR
RADIATOR_ON_WIN:CODE={ /
    CONSTRUCTION_PHASE^SET(11); /
}

OBJECT=SHOW_BOTTLE_FLUID_LEVEL_NAME
SHOW_BOTTLE_FLUID_LEVEL_NAME:TYPE=STRING

OBJECT=SHOW_BOTTLE_FLUID_LEVEL_CURRENT
SHOW_BOTTLE_FLUID_LEVEL_CURRENT:TYPE=STRING

OBJECT=SHOW_BOTTLE_FLUID_LEVEL_MAX
SHOW_BOTTLE_FLUID_LEVEL_MAX:TYPE=STRING

OBJECT=SHOW_BOTTLE_FLUID_LEVEL
SHOW_BOTTLE_FLUID_LEVEL:TYPE=BEHAVIOUR
SHOW_BOTTLE_FLUID_LEVEL:CODE={ /
    SHOW_BOTTLE_FLUID_LEVEL_NAME^SET(["BUTELKA_STAN" + $1]); /
    SHOW_BOTTLE_FLUID_LEVEL_CURRENT^SET(["CURRENT" + $1]); /
    SHOW_BOTTLE_FLUID_LEVEL_MAX^SET(["MAX" + $1]); /
    *SHOW_BOTTLE_FLUID_LEVEL_NAME^PLAY(PLAY1); /
    @IF(*SHOW_BOTTLE_FLUID_LEVEL_CURRENT^GET(), "_", 0, "{*SHOW_BOTTLE_FLUID_LEVEL_NAME^PLAY(PLAY0);}", ""); /
    @IF(*SHOW_BOTTLE_FLUID_LEVEL_CURRENT^GET(), "_", SHOW_BOTTLE_FLUID_LEVEL_MAX^GET(), "{*SHOW_BOTTLE_FLUID_LEVEL_NAME^PLAY(PLAY2);}", ""); /
}

OBJECT=END_SIGMALIS
END_SIGMALIS:TYPE=BEHAVIOUR
END_SIGMALIS:CODE={ /
    EPISODE^GOTO(CONSTRUCTION_PLACE); /
}
